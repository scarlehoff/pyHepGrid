

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Usage &mdash; pyHepGrid  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Monitoring" href="monitoring.html" />
    <link rel="prev" title="Setup" href="setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyHepGrid
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pyhepgrid-instruction-set">pyHepGrid instruction set</a></li>
<li class="toctree-l2"><a class="reference internal" href="#finalising-results">Finalising results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-setup">Default setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-setups">Custom setups</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#normal-workflow">Normal workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#runcard-py-files-details">runcard.py files details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyHepGrid</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<span id="usage-label"></span><h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>This page contains the pyHepGrid usage guide.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#pyhepgrid-instruction-set" id="id1">pyHepGrid instruction set</a></p></li>
<li><p><a class="reference internal" href="#finalising-results" id="id2">Finalising results</a></p>
<ul>
<li><p><a class="reference internal" href="#default-setup" id="id3">Default setup</a></p></li>
<li><p><a class="reference internal" href="#custom-setups" id="id4">Custom setups</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#normal-workflow" id="id5">Normal workflow</a></p></li>
<li><p><a class="reference internal" href="#runcard-py-files-details" id="id6">runcard.py files details</a></p></li>
</ul>
</div>
<div class="section" id="pyhepgrid-instruction-set">
<h2><a class="toc-backref" href="#id1">pyHepGrid instruction set</a><a class="headerlink" href="#pyhepgrid-instruction-set" title="Permalink to this headline">¶</a></h2>
<ol class="arabic" start="0">
<li><p>For nnlojet developers only: initialise LHAPDF</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid ini -L
</pre></div>
</div>
</li>
<li><p>initialise runcard</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid ini runcard.py -B
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">-B</span></code> is production in arc <code class="docutils literal notranslate"><span class="pre">-D</span></code> in dirac <code class="docutils literal notranslate"><span class="pre">-A</span></code> is warmup in arc.
If you want to provide warmup files add <code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">warmup.file</span></code>.</p>
</li>
<li><p>test your setup locally</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid <span class="nb">test</span> runcard.py -B
</pre></div>
</div>
<p>Make sure that you only run a small, quick setup locally, e.g. limit the
number of events. <code class="docutils literal notranslate"><span class="pre">test</span></code> will always use seed 0.</p>
</li>
<li><p>send the jobs to run with one of:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid run &lt;runcard.py&gt; -A <span class="c1"># ARC WARMUP</span>
pyHepGrid run &lt;runcard.py&gt; -B <span class="c1"># ARC PRODUCTION</span>
pyHepGrid run &lt;runcard.py&gt; -D <span class="c1"># DIRAC PRODUCTION</span>
</pre></div>
</div>
</li>
<li><p>manage the jobs/view the database of runs with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid man &lt;runcard.py&gt; -<span class="o">(</span>A/B/D<span class="o">)</span>
</pre></div>
</div>
<p>include one or multiple of the following flags:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-S/-s</span></code> for job status</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span></code> to print the stdout of the job (selects last job of set if production)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-P</span></code> to print the job log file (selects last job of set if production)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-I/-i</span></code> for job information</p></li>
</ul>
</div></blockquote>
</li>
</ol>
<p>For running anything on the grid, the help text in <code class="docutils literal notranslate"><span class="pre">pyHepGrid</span>
<span class="pre">-h</span></code> is useful for hidden options that aren’t all necessarily documented(!).
These features include warmup continuation, getting warmup data from running
warmup jobs, initialising with your own warmup from elsewhere, database
management stuff, running on the test queue.</p>
<p>When running, the python script <code class="docutils literal notranslate"><span class="pre">runfile</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">nnlorun.py</span></code>) is sent to the run
location. This script then runs automatically, and pulls all of the appropriate
files from grid storage (e.g. NNLOJET executable, runcard, warmups). It then runs
NNLOJET in the appropriate mode, before tarring up output files and sending
them back to the grid storage.</p>
</div>
<div class="section" id="finalising-results">
<h2><a class="toc-backref" href="#id2">Finalising results</a><a class="headerlink" href="#finalising-results" title="Permalink to this headline">¶</a></h2>
<p>The process of pulling the production results from grid storage to the gridui.
You have a choice of setups for this (or you can implement your own)</p>
<div class="section" id="default-setup">
<h3><a class="toc-backref" href="#id3">Default setup</a><a class="headerlink" href="#default-setup" title="Permalink to this headline">¶</a></h3>
<p>By default, <code class="docutils literal notranslate"><span class="pre">pyHepGrid</span></code> ships a <code class="docutils literal notranslate"><span class="pre">&quot;--get_data&quot;</span></code> script that allows you to
retrieve jobs looking at the database.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid man -A --get_data
</pre></div>
</div>
<p>For ARC runs (either production or warmup)
or for Dirac runs:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid man -D --get_data
</pre></div>
</div>
<p>The script will then ask you which database entry do you want to retrieve and
will put the contents in the folders defined in your header.
<code class="docutils literal notranslate"><span class="pre">warmup_base_dir/date/of/job/RUNNAME</span></code> for warm-ups or
<code class="docutils literal notranslate"><span class="pre">production_base_dir/date/of/job/RUNNAME</span></code> for production.</p>
<p>For instance, let’s suppose you sent 4000 production runs to Dirac on the 1st of
March and this job’s entry is 14, you can do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid man -D -g -j <span class="m">14</span>
</pre></div>
</div>
<p>and it will download all .dat and .log files to <code class="docutils literal notranslate"><span class="pre">warmup_base_dir/March/1/RUNNAME</span></code></p>
</div>
<div class="section" id="custom-setups">
<h3><a class="toc-backref" href="#id4">Custom setups</a><a class="headerlink" href="#custom-setups" title="Permalink to this headline">¶</a></h3>
<p>For your own custom setup, you just need to write a finalisation script which
exposes a function called <code class="docutils literal notranslate"><span class="pre">do_finalise()</span></code>. This function does the pulling from
the grid storage. You then set the variable <code class="docutils literal notranslate"><span class="pre">finalisation_script</span></code> to the name of
your script (without the <code class="docutils literal notranslate"><span class="pre">.py</span></code> suffix). For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./finalise.py
</pre></div>
</div>
<p>set <code class="docutils literal notranslate"><span class="pre">finalisation_script</span> <span class="pre">=</span> <span class="pre">&quot;finalise&quot;</span></code> in your header and just do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pyHepGrid man --get_data
</pre></div>
</div>
<p>This will find all of the runcards specified at the top of <code class="docutils literal notranslate"><span class="pre">finalise_runcard.py</span></code>
(or other as specified in <code class="docutils literal notranslate"><span class="pre">finalise_runcards</span></code>) and pull all of the data it can
find for them from the grid storage. The output will be stored in
<code class="docutils literal notranslate"><span class="pre">production_base_dir</span></code> (as set in the header) with one folder for each set of
runs, and the prefix as set in <code class="docutils literal notranslate"><span class="pre">finalise_prefix</span></code>. Corrupted data in the grid
storage will be deleted.</p>
</div>
</div>
<div class="section" id="normal-workflow">
<h2><a class="toc-backref" href="#id5">Normal workflow</a><a class="headerlink" href="#normal-workflow" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple" start="0">
<li><p>Make sure you have a working proxy</p></li>
<li><p>initialise warmup runcard (optional)</p></li>
<li><p>run warmup runcard (optional)</p></li>
<li><p>switch warmup -&gt; production in runcard</p></li>
<li><p>When warmup complete, reinitialise runcard for production</p></li>
<li><p>run production runcard as many times as you like w/ different seeds</p></li>
<li><p>pull down the results (finalisation)</p></li>
</ol>
</div>
<div class="section" id="runcard-py-files-details">
<h2><a class="toc-backref" href="#id6">runcard.py files details</a><a class="headerlink" href="#runcard-py-files-details" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Include a dictionary of all of the runcards you want to
submit/initialise/manage, along with an identification tag that you can use
for local accounting</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">template_runcard.py</span></code> is the canonical example</p></li>
<li><p>Must be valid python to be used</p></li>
<li><p>Has a functionality whereby you can override any parameters in your header
file by specifying them in the runcard file. So you can e.g specify a
different submission location for specific runs, give different starting
seeds/numbers of production runs.</p></li>
<li><p>You can even link/import functions to e.g dynamically find the best submission
location</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="monitoring.html" class="btn btn-neutral float-right" title="Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="setup.html" class="btn btn-neutral float-left" title="Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>